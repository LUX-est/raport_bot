# Report Bot (aiogram 3.21.0 + Python 3.11.7)

Базовый рабочий бот по ТЗ: сотрудники сдают рапорты и сообщают о проблемах, администраторы проверяют рапорты.

## Что есть в этой версии
- Регистрация сотрудника (имя/фамилия/должность/город) по Telegram ID
- Сдача рапорта (дата → типы работ (мультивыбор) → количество по каждому типу → время → комментарий (опц.) → фото/видео (опц.) → предпросмотр → отправка)
- Сообщение о проблеме (тип → описание → адрес/объект → номер самоката (опц.) → фото/видео 0–5 → срочность → предпросмотр → отправка)
- История рапортов + суммарный объём задач за текущий месяц
- Админ-часть: уведомления о новых рапортах, принятие/отклонение (комментарий обязателен при отклонении), базовая панель и настройки (обязательность фото, добавление типов работ)
- Хранение данных: SQLite (bot.db) через SQLAlchemy (async)

## Чего нет (сознательно, чтобы было "без Google")
- Интеграции с Google Sheets (добавим на следующем этапе: сервисный аккаунт + gspread/Google API)
- Продвинутой фильтрации/экспорта в админке (есть каркас, можно расширять)

## Быстрый старт
1) Установить Python 3.11.7
2) Создать виртуальное окружение и поставить зависимости:
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Windows: .venv\Scripts\activate
   pip install -r requirements.txt
   ```
3) Создать `.env` по образцу:
   ```bash
   cp .env.example .env
   ```
   Заполнить `BOT_TOKEN` и `ADMIN_IDS`.
4) Запуск:
   ```bash
   python -m app.main
   ```

## Команды
- /start — старт и регистрация
- /admin — открыть админ-панель (только админы)


## Обновления (v2)
- Все основные меню — **inline-кнопки**
- Админ-панель доступна **только через /admin**
- Кнопки **Начал работу / Закончить работу**:
  - бот запоминает время старта/финиша
  - при сдаче рапорта время подставляется автоматически (если дата совпадает)
- Редактирование рапортов сотрудником:
  - в «Мои рапорты» доступны кнопки «Редактировать #ID»
  - админ получает уведомление, кто и сколько раз редактировал
- Админ «Сообщение дня»:
  - задаётся в админке
  - отправляется сотруднику при нажатии «Начал работу»
- Админ «Сотрудники»:
  - показывает кто сейчас работает и с какого времени
  - можно написать сотруднику прямо из бота
- Google Sheets:
  - записи в таблицу при создании рапорта/проблемы, при редактировании и при смене статуса рапорта
  - формат: отдельные колонки с заголовками; листы создаются автоматически

### Google Sheets настройка
1) Создай Google Spreadsheet и скопируй **Spreadsheet ID** из URL
2) Создай Service Account, скачай JSON и положи в корень проекта (например `service_account.json`)
3) Дай доступ сервисному аккаунту на таблицу (как на обычную почту)
4) Заполни в `.env`:
   - GOOGLE_SERVICE_ACCOUNT_FILE=./service_account.json
   - GOOGLE_SPREADSHEET_ID=...
